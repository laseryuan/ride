#!/bin/sh

if pgrep -x "sshd" >/dev/null
then
  echo "sshd already is running"
else
  echo "start sshd server"
  # build authorized_key
  if [[ $EUID -ne 0 ]]; then
    sudo chown ride:ride /tmp
  fi
  chmod 755 /tmp

  echo "force user tmux a"
  curl -sSL -o /tmp/authorized_keys https://github.com/laseryuan.keys
  sed -i -e 's/^/command="tmux a" /' /tmp/authorized_keys
  chmod 600 /tmp/authorized_keys

  sudo /usr/sbin/sshd -o AuthorizedKeysFile=/tmp/authorized_keys -o PasswordAuthentication=no
fi
